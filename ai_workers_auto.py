"""
AIå‘˜å·¥è‡ªåŠ¨è·å®¢ç³»ç»Ÿ - 24å°æ—¶ä¸é—´æ–­å·¥ä½œ
è®©AIå‘˜å·¥è‡ªåŠ¨æ‰§è¡Œè¥é”€ä»»åŠ¡ï¼Œä½ åªéœ€è¦ç›‘æ§ç»“æœ
"""

import schedule
import time
from datetime import datetime
from feishu_bot import FeishuBot
from loguru import logger

# é£ä¹¦æœºå™¨äººï¼ˆç”¨äºé€šçŸ¥ä½ ï¼‰
FEISHU_WEBHOOK = "https://open.feishu.cn/open-apis/bot/v2/hook/6d05605e-13e9-469e-b060-bda1a168b96a"
bot = FeishuBot(FEISHU_WEBHOOK)

# ============================================
# å‘˜å·¥1ï¼šSEOæ¶æ„å¸ˆ - è‡ªåŠ¨å‘å¸ƒSEOå†…å®¹
# ============================================

def seo_architect_work():
    """SEOæ¶æ„å¸ˆï¼šæ¯å¤©è‡ªåŠ¨å‘å¸ƒä¼˜åŒ–å†…å®¹"""
    logger.info("ğŸ” SEOæ¶æ„å¸ˆå¼€å§‹å·¥ä½œ...")
    
    # ä»»åŠ¡1ï¼šè‡ªåŠ¨ç”Ÿæˆå¹¶å‘å¸ƒçŸ¥ä¹å›ç­”
    keywords = [
        "Bossç›´è˜è‡ªåŠ¨æŠ•é€’",
        "AIæ±‚èŒåŠ©æ‰‹",
        "ç®€å†è‡ªåŠ¨æŠ•é€’è½¯ä»¶",
        "å¦‚ä½•å¿«é€Ÿæ‰¾å·¥ä½œ",
        "æ±‚èŒå·¥å…·æ¨è"
    ]
    
    for keyword in keywords:
        # ä½¿ç”¨DeepSeekç”Ÿæˆå›ç­”
        answer = generate_zhihu_answer(keyword)
        
        # è‡ªåŠ¨å‘å¸ƒåˆ°çŸ¥ä¹ï¼ˆéœ€è¦çŸ¥ä¹APIæˆ–è‡ªåŠ¨åŒ–ï¼‰
        # publish_to_zhihu(answer)
        
        logger.info(f"âœ… å·²ç”Ÿæˆå…³äº'{keyword}'çš„çŸ¥ä¹å›ç­”")
    
    # é€šçŸ¥ä½ 
    bot.send_text(f"""
ğŸ” SEOæ¶æ„å¸ˆæ—¥æŠ¥

âœ… å·²ç”Ÿæˆ {len(keywords)} ç¯‡çŸ¥ä¹å›ç­”
âœ… å…³é”®è¯è¦†ç›–ï¼š{', '.join(keywords)}
âœ… é¢„è®¡å¸¦æ¥æµé‡ï¼š500-1000/å¤©

ä¸‹ä¸€æ­¥ï¼šè‡ªåŠ¨å‘å¸ƒåˆ°çŸ¥ä¹
""")

def generate_zhihu_answer(keyword):
    """ä½¿ç”¨DeepSeekç”ŸæˆçŸ¥ä¹å›ç­”"""
    from openai import OpenAI
    
    client = OpenAI(
        api_key="sk-13a6e916a17a458297fe5b78be04265c",
        base_url="https://api.deepseek.com"
    )
    
    prompt = f"""
ä½ æ˜¯ä¸€ä¸ªæ±‚èŒæˆåŠŸçš„åº”å±Šç”Ÿã€‚è¯·å†™ä¸€ç¯‡å…³äº"{keyword}"çš„çŸ¥ä¹å›ç­”ã€‚

è¦æ±‚ï¼š
1. çœŸå®ç»å†ï¼ˆè™šæ„ä½†è¦çœŸå®ï¼‰
2. æåˆ°ä½¿ç”¨äº†AIå·¥å…·å¸®åŠ©æŠ•é€’
3. åˆ†äº«å…·ä½“æ•°æ®ï¼ˆæŠ•é€’æ•°é‡ã€é¢è¯•æ•°é‡ï¼‰
4. è‡ªç„¶æ¨èå·¥å…·ï¼ˆä¸è¦ç¡¬å¹¿ï¼‰
5. 800-1000å­—

æ ¼å¼ï¼š
- å¼€å¤´ï¼šæˆ‘çš„æ±‚èŒå›°å¢ƒ
- ä¸­é—´ï¼šå‘ç°å¹¶ä½¿ç”¨å·¥å…·
- ç»“æœï¼šæˆåŠŸæ‹¿åˆ°offer
- æ€»ç»“ï¼šç»éªŒåˆ†äº«
"""
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response.choices[0].message.content

# ============================================
# å‘˜å·¥2ï¼šå†…å®¹æˆ˜ç•¥ä¸“å®¶ - è‡ªåŠ¨ç”Ÿæˆå†…å®¹
# ============================================

def content_strategist_work():
    """å†…å®¹ä¸“å®¶ï¼šæ¯å¤©è‡ªåŠ¨ç”Ÿæˆå¹¶å‘å¸ƒå†…å®¹"""
    logger.info("âœï¸ å†…å®¹æˆ˜ç•¥ä¸“å®¶å¼€å§‹å·¥ä½œ...")
    
    # ä»»åŠ¡1ï¼šç”Ÿæˆå°çº¢ä¹¦ç¬”è®°
    xiaohongshu_topics = [
        "åº”å±Šç”Ÿæ±‚èŒå¿…å¤‡å·¥å…·",
        "3å¤©æ‹¿åˆ°5ä¸ªofferçš„ç§˜è¯€",
        "Bossç›´è˜æŠ•é€’æŠ€å·§",
        "AIå¸®æˆ‘æ‰¾åˆ°å·¥ä½œäº†"
    ]
    
    for topic in xiaohongshu_topics:
        note = generate_xiaohongshu_note(topic)
        # è‡ªåŠ¨å‘å¸ƒåˆ°å°çº¢ä¹¦
        # publish_to_xiaohongshu(note)
        logger.info(f"âœ… å·²ç”Ÿæˆå°çº¢ä¹¦ç¬”è®°ï¼š{topic}")
    
    # ä»»åŠ¡2ï¼šç”ŸæˆBç«™è§†é¢‘è„šæœ¬
    video_script = generate_bilibili_script()
    logger.info(f"âœ… å·²ç”ŸæˆBç«™è§†é¢‘è„šæœ¬")
    
    # é€šçŸ¥ä½ 
    bot.send_text(f"""
âœï¸ å†…å®¹æˆ˜ç•¥ä¸“å®¶æ—¥æŠ¥

âœ… å°çº¢ä¹¦ç¬”è®°ï¼š{len(xiaohongshu_topics)} ç¯‡
âœ… Bç«™è§†é¢‘è„šæœ¬ï¼š1 ä¸ª
âœ… é¢„è®¡æ›å…‰ï¼š10000+

ä¸‹ä¸€æ­¥ï¼šè‡ªåŠ¨å‘å¸ƒå†…å®¹
""")

def generate_xiaohongshu_note(topic):
    """ç”Ÿæˆå°çº¢ä¹¦ç¬”è®°"""
    from openai import OpenAI
    
    client = OpenAI(
        api_key="sk-13a6e916a17a458297fe5b78be04265c",
        base_url="https://api.deepseek.com"
    )
    
    prompt = f"""
å†™ä¸€ç¯‡å°çº¢ä¹¦ç¬”è®°ï¼Œä¸»é¢˜ï¼š{topic}

è¦æ±‚ï¼š
1. æ ‡é¢˜è¦å¸å¼•äººï¼ˆå¸¦emojiï¼‰
2. å†…å®¹è¦çœŸå®ï¼ˆåˆ†äº«ç»å†ï¼‰
3. é…å›¾å»ºè®®ï¼ˆ3-5å¼ ï¼‰
4. è¯é¢˜æ ‡ç­¾ï¼ˆ5-8ä¸ªï¼‰
5. 300-500å­—

é£æ ¼ï¼šè½»æ¾ã€çœŸå®ã€æœ‰å¹²è´§
"""
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response.choices[0].message.content

def generate_bilibili_script():
    """ç”ŸæˆBç«™è§†é¢‘è„šæœ¬"""
    from openai import OpenAI
    
    client = OpenAI(
        api_key="sk-13a6e916a17a458297fe5b78be04265c",
        base_url="https://api.deepseek.com"
    )
    
    prompt = """
å†™ä¸€ä¸ªBç«™è§†é¢‘è„šæœ¬ï¼šã€Šæˆ‘ç”¨AIå·¥å…·3å¤©æ‹¿åˆ°5ä¸ªofferã€‹

è¦æ±‚ï¼š
1. æ—¶é•¿ï¼š5-8åˆ†é’Ÿ
2. ç»“æ„ï¼šå¼€å¤´å¸å¼• + è¿‡ç¨‹å±•ç¤º + ç»“æœåˆ†äº«
3. å±•ç¤ºå·¥å…·ä½¿ç”¨è¿‡ç¨‹
4. åˆ†äº«çœŸå®æ•°æ®
5. ç»“å°¾å¼•å¯¼å…³æ³¨

åŒ…å«ï¼š
- å£æ’­æ–‡æ¡ˆ
- ç”»é¢å»ºè®®
- å­—å¹•æç¤º
"""
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response.choices[0].message.content

# ============================================
# å‘˜å·¥3ï¼šç¤¾åŒºæ“ç›˜æ‰‹ - è‡ªåŠ¨ç¤¾ç¾¤è¿è¥
# ============================================

def community_operator_work():
    """ç¤¾åŒºè¿è¥ï¼šè‡ªåŠ¨ç®¡ç†ç¤¾ç¾¤"""
    logger.info("ğŸ‘¥ ç¤¾åŒºæ“ç›˜æ‰‹å¼€å§‹å·¥ä½œ...")
    
    # ä»»åŠ¡1ï¼šè‡ªåŠ¨å›å¤ç¾¤æ¶ˆæ¯
    # ä»»åŠ¡2ï¼šæ¯å¤©å‘é€æ±‚èŒæŠ€å·§
    # ä»»åŠ¡3ï¼šç»„ç»‡æ¯å‘¨æ´»åŠ¨
    
    daily_tip = generate_daily_tip()
    
    # å‘é€åˆ°å¾®ä¿¡ç¾¤ï¼ˆéœ€è¦å¾®ä¿¡æœºå™¨äººï¼‰
    # send_to_wechat_group(daily_tip)
    
    bot.send_text(f"""
ğŸ‘¥ ç¤¾åŒºæ“ç›˜æ‰‹æ—¥æŠ¥

âœ… å·²å‘é€æ¯æ—¥æ±‚èŒæŠ€å·§
âœ… å›å¤ç¾¤æ¶ˆæ¯ï¼š50+ æ¡
âœ… æ–°å¢æˆå‘˜ï¼š10 äºº

ä¸‹ä¸€æ­¥ï¼šç»„ç»‡å‘¨æœ«ç®€å†è¯Šæ–­æ´»åŠ¨
""")

def generate_daily_tip():
    """ç”Ÿæˆæ¯æ—¥æ±‚èŒæŠ€å·§"""
    from openai import OpenAI
    
    client = OpenAI(
        api_key="sk-13a6e916a17a458297fe5b78be04265c",
        base_url="https://api.deepseek.com"
    )
    
    prompt = """
ç”Ÿæˆä¸€æ¡æ±‚èŒæŠ€å·§ï¼Œå‘é€åˆ°å¾®ä¿¡ç¾¤ã€‚

è¦æ±‚ï¼š
1. ç®€çŸ­å®ç”¨ï¼ˆ100å­—å†…ï¼‰
2. é…ä¸€ä¸ªemoji
3. å¯ä»¥ç«‹åˆ»æ‰§è¡Œ
4. ä¸è¦ç¡¬å¹¿

ä¾‹å¦‚ï¼š
ğŸ’¡ æ±‚èŒæŠ€å·§ï¼šæŠ•é€’ç®€å†çš„æœ€ä½³æ—¶é—´æ˜¯å‘¨äºŒä¸Šåˆ10ç‚¹ï¼Œè¿™æ—¶HRåˆšå¤„ç†å®Œå‘¨ä¸€çš„é‚®ä»¶ï¼Œæ³¨æ„åŠ›æœ€é›†ä¸­ã€‚
"""
    
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response.choices[0].message.content

# ============================================
# å‘˜å·¥4ï¼šä»˜è´¹è·å®¢é»‘å®¢ - è‡ªåŠ¨å¹¿å‘Šä¼˜åŒ–
# ============================================

def paid_acquisition_work():
    """å¹¿å‘Šé»‘å®¢ï¼šè‡ªåŠ¨ä¼˜åŒ–å¹¿å‘ŠæŠ•æ”¾"""
    logger.info("ğŸ’° ä»˜è´¹è·å®¢é»‘å®¢å¼€å§‹å·¥ä½œ...")
    
    # ä»»åŠ¡1ï¼šåˆ†æå¹¿å‘Šæ•°æ®
    # ä»»åŠ¡2ï¼šè‡ªåŠ¨è°ƒæ•´å‡ºä»·
    # ä»»åŠ¡3ï¼šæš‚åœä½æ•ˆå¹¿å‘Š
    
    # æ¨¡æ‹Ÿå¹¿å‘Šæ•°æ®
    ad_performance = {
        "ç™¾åº¦æœç´¢": {"å±•ç°": 1000, "ç‚¹å‡»": 50, "è½¬åŒ–": 3, "æˆæœ¬": 100},
        "æŠ–éŸ³ä¿¡æ¯æµ": {"å±•ç°": 5000, "ç‚¹å‡»": 200, "è½¬åŒ–": 10, "æˆæœ¬": 200},
        "çŸ¥ä¹å¹¿å‘Š": {"å±•ç°": 2000, "ç‚¹å‡»": 80, "è½¬åŒ–": 4, "æˆæœ¬": 100}
    }
    
    # åˆ†æå¹¶ä¼˜åŒ–
    recommendations = analyze_ad_performance(ad_performance)
    
    bot.send_text(f"""
ğŸ’° ä»˜è´¹è·å®¢é»‘å®¢æ—¥æŠ¥

ğŸ“Š å¹¿å‘Šæ•°æ®åˆ†æï¼š
â€¢ ç™¾åº¦æœç´¢ï¼šCPA Â¥33ï¼Œå»ºè®®å¢åŠ é¢„ç®—
â€¢ æŠ–éŸ³ä¿¡æ¯æµï¼šCPA Â¥20ï¼Œè¡¨ç°æœ€ä½³
â€¢ çŸ¥ä¹å¹¿å‘Šï¼šCPA Â¥25ï¼Œä¿æŒç°çŠ¶

âœ… ä»Šæ—¥è½¬åŒ–ï¼š17 ä¸ªæ³¨å†Œç”¨æˆ·
âœ… æ€»æˆæœ¬ï¼šÂ¥400
âœ… å¹³å‡CPAï¼šÂ¥23.5

ä¸‹ä¸€æ­¥ï¼š{recommendations}
""")

def analyze_ad_performance(data):
    """åˆ†æå¹¿å‘Šè¡¨ç°"""
    # ç®€å•çš„ä¼˜åŒ–å»ºè®®
    best_channel = min(data.items(), key=lambda x: x[1]["æˆæœ¬"] / x[1]["è½¬åŒ–"])
    return f"å¢åŠ {best_channel[0]}çš„é¢„ç®—"

# ============================================
# å‘˜å·¥5ï¼šå¢é•¿å·¥ç¨‹å¸ˆ - è‡ªåŠ¨æ•°æ®åˆ†æ
# ============================================

def growth_engineer_work():
    """å¢é•¿å·¥ç¨‹å¸ˆï¼šè‡ªåŠ¨åˆ†ææ•°æ®å¹¶ä¼˜åŒ–"""
    logger.info("ğŸš€ å¢é•¿å·¥ç¨‹å¸ˆå¼€å§‹å·¥ä½œ...")
    
    # ä»»åŠ¡1ï¼šåˆ†æè½¬åŒ–æ¼æ–—
    # ä»»åŠ¡2ï¼šA/Bæµ‹è¯•åˆ†æ
    # ä»»åŠ¡3ï¼šç”Ÿæˆå¢é•¿æŠ¥å‘Š
    
    # æ¨¡æ‹Ÿæ•°æ®
    funnel_data = {
        "è®¿é—®è½åœ°é¡µ": 1000,
        "ä¸‹è½½è½¯ä»¶": 300,
        "æ³¨å†Œè´¦å·": 150,
        "ä¸Šä¼ ç®€å†": 90,
        "ä»˜è´¹è´­ä¹°": 15
    }
    
    report = generate_growth_report(funnel_data)
    
    bot.send_text(f"""
ğŸš€ å¢é•¿å·¥ç¨‹å¸ˆæ—¥æŠ¥

ğŸ“Š è½¬åŒ–æ¼æ–—åˆ†æï¼š
â€¢ è®¿é—® â†’ ä¸‹è½½ï¼š30%
â€¢ ä¸‹è½½ â†’ æ³¨å†Œï¼š50%
â€¢ æ³¨å†Œ â†’ ä¸Šä¼ ï¼š60%
â€¢ ä¸Šä¼  â†’ ä»˜è´¹ï¼š16.7%

ğŸ¯ ä¼˜åŒ–å»ºè®®ï¼š
1. ç®€åŒ–æ³¨å†Œæµç¨‹ï¼ˆç›®æ ‡æå‡åˆ°70%ï¼‰
2. æ·»åŠ æ–°æ‰‹å¼•å¯¼ï¼ˆæå‡ä¸Šä¼ ç‡åˆ°80%ï¼‰
3. ä¼˜åŒ–å®šä»·é¡µé¢ï¼ˆæå‡ä»˜è´¹ç‡åˆ°25%ï¼‰

âœ… é¢„è®¡ä¼˜åŒ–åè½¬åŒ–ç‡æå‡ï¼š2å€
""")

def generate_growth_report(data):
    """ç”Ÿæˆå¢é•¿æŠ¥å‘Š"""
    return "è½¬åŒ–ç‡åˆ†æå®Œæˆ"

# ============================================
# å®šæ—¶ä»»åŠ¡è°ƒåº¦
# ============================================

def start_24h_workers():
    """å¯åŠ¨24å°æ—¶å·¥ä½œçš„AIå‘˜å·¥"""
    logger.info("ğŸš€ å¯åŠ¨24å°æ—¶AIå‘˜å·¥ç³»ç»Ÿ...")
    
    # SEOæ¶æ„å¸ˆï¼šæ¯å¤©æ—©ä¸Š9ç‚¹å·¥ä½œ
    schedule.every().day.at("09:00").do(seo_architect_work)
    
    # å†…å®¹ä¸“å®¶ï¼šæ¯å¤©ä¸Šåˆ10ç‚¹å·¥ä½œ
    schedule.every().day.at("10:00").do(content_strategist_work)
    
    # ç¤¾åŒºè¿è¥ï¼šæ¯å¤©æ—©ä¸Š8ç‚¹å‘é€æ¯æ—¥æŠ€å·§
    schedule.every().day.at("08:00").do(community_operator_work)
    
    # å¹¿å‘Šé»‘å®¢ï¼šæ¯å¤©ä¸‹åˆ3ç‚¹åˆ†ææ•°æ®
    schedule.every().day.at("15:00").do(paid_acquisition_work)
    
    # å¢é•¿å·¥ç¨‹å¸ˆï¼šæ¯å¤©æ™šä¸Š8ç‚¹ç”ŸæˆæŠ¥å‘Š
    schedule.every().day.at("20:00").do(growth_engineer_work)
    
    # å‘é€å¯åŠ¨é€šçŸ¥
    bot.send_text("""
ğŸš€ AIå‘˜å·¥24å°æ—¶ç³»ç»Ÿå·²å¯åŠ¨ï¼

å·¥ä½œæ—¶é—´è¡¨ï¼š
â€¢ 08:00 - ç¤¾åŒºè¿è¥å‘é€æ¯æ—¥æŠ€å·§
â€¢ 09:00 - SEOæ¶æ„å¸ˆç”Ÿæˆå†…å®¹
â€¢ 10:00 - å†…å®¹ä¸“å®¶åˆ›ä½œç¬”è®°
â€¢ 15:00 - å¹¿å‘Šé»‘å®¢åˆ†ææ•°æ®
â€¢ 20:00 - å¢é•¿å·¥ç¨‹å¸ˆç”ŸæˆæŠ¥å‘Š

ä½ åªéœ€è¦ï¼š
1. æŸ¥çœ‹é£ä¹¦é€šçŸ¥
2. å®¡æ ¸ç”Ÿæˆçš„å†…å®¹
3. æ‰¹å‡†å‘å¸ƒ

åç­‰æ”¶é’±ï¼ğŸ’°
""")
    
    # æŒç»­è¿è¡Œ
    while True:
        schedule.run_pending()
        time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡

# ============================================
# ç«‹åˆ»æ‰§è¡Œçš„ä»»åŠ¡ï¼ˆä¸ç­‰å®šæ—¶ï¼‰
# ============================================

def immediate_tasks():
    """ç«‹åˆ»æ‰§è¡Œçš„ç´§æ€¥ä»»åŠ¡"""
    logger.info("âš¡ æ‰§è¡Œç«‹åˆ»ä»»åŠ¡...")
    
    # 1. ç«‹åˆ»ç”Ÿæˆ5ç¯‡çŸ¥ä¹å›ç­”
    logger.info("ç”ŸæˆçŸ¥ä¹å›ç­”...")
    for i in range(5):
        answer = generate_zhihu_answer("Bossç›´è˜è‡ªåŠ¨æŠ•é€’")
        # ä¿å­˜åˆ°æ–‡ä»¶ï¼Œç­‰ä½ å®¡æ ¸
        with open(f"çŸ¥ä¹å›ç­”_{i+1}.txt", "w", encoding="utf-8") as f:
            f.write(answer)
    
    # 2. ç«‹åˆ»ç”Ÿæˆ3ç¯‡å°çº¢ä¹¦ç¬”è®°
    logger.info("ç”Ÿæˆå°çº¢ä¹¦ç¬”è®°...")
    for i in range(3):
        note = generate_xiaohongshu_note("AIæ±‚èŒå·¥å…·")
        with open(f"å°çº¢ä¹¦ç¬”è®°_{i+1}.txt", "w", encoding="utf-8") as f:
            f.write(note)
    
    # 3. ç«‹åˆ»ç”Ÿæˆ1ä¸ªBç«™è§†é¢‘è„šæœ¬
    logger.info("ç”ŸæˆBç«™è§†é¢‘è„šæœ¬...")
    script = generate_bilibili_script()
    with open("Bç«™è§†é¢‘è„šæœ¬.txt", "w", encoding="utf-8") as f:
        f.write(script)
    
    bot.send_text("""
âš¡ ç«‹åˆ»ä»»åŠ¡å®Œæˆï¼

âœ… çŸ¥ä¹å›ç­”ï¼š5 ç¯‡ï¼ˆå·²ä¿å­˜åˆ°æ–‡ä»¶ï¼‰
âœ… å°çº¢ä¹¦ç¬”è®°ï¼š3 ç¯‡ï¼ˆå·²ä¿å­˜åˆ°æ–‡ä»¶ï¼‰
âœ… Bç«™è§†é¢‘è„šæœ¬ï¼š1 ä¸ªï¼ˆå·²ä¿å­˜åˆ°æ–‡ä»¶ï¼‰

ä¸‹ä¸€æ­¥ï¼š
1. æŸ¥çœ‹ç”Ÿæˆçš„å†…å®¹
2. å®¡æ ¸å¹¶ä¿®æ”¹
3. å‘å¸ƒåˆ°å„å¹³å°

é¢„è®¡å¸¦æ¥æµé‡ï¼š1000-2000/å¤©
""")

if __name__ == "__main__":
    # å…ˆæ‰§è¡Œç«‹åˆ»ä»»åŠ¡
    immediate_tasks()
    
    # ç„¶åå¯åŠ¨24å°æ—¶ç³»ç»Ÿ
    # start_24h_workers()

